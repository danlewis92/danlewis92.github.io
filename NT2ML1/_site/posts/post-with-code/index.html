<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dan Lewis">
<meta name="dcterms.date" content="2024-12-19">

<title>So, what have you been up to, Dan? – Number theory -&gt; Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-f23ab18612d661d7bd56dbc0c0fd3817.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1322888c997fad56b0b4d776d35cf542.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Number theory -&gt; Machine Learning</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/danlewis92"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/daniel-lewis-1440"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/DanLewis3264"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">So, what have you been up to, Dan?</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">news</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">Deep Learning</div>
                <div class="quarto-category">GANs</div>
                <div class="quarto-category">fast.ai</div>
                <div class="quarto-category">SQL</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Dan Lewis </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 19, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Hello and welcome to this first blogpost, in which I aim to highlight five of the best resources that I have been using since August in my bid to review Machine Learning fundamentals and prepare for an industry role in Data Science.</p>
<p>My hope is that you find these sites helpful too, and can get going with them with the minimum of fuss, given your advanced background.</p>
<p>So, in no particular order:</p>
<ol type="1">
<li><a href="https://deeplearning.cs.cmu.edu/F24/index.html" title="CMU">CMU’s Deep Learning course</a></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CMU.png" title="CMU" class="img-fluid figure-img"></p>
<figcaption>Prof Raj in his element, pointing with the trident.</figcaption>
</figure>
</div>
<p>Hat-tip (h/t) to Ivan at Meta for pointing me in the direction of this course, which provides a thorough introduction to Deep Learning, starting with the Multi Layer Perceptron (MLP) architecture and including Convolutional and Recurrent Neural Networks (CNNs and RNNs), as well as more modern architectures like the Transformer that underpins Large Language Models (LLMs).</p>
<p>One thing I really like about this course (and this will come as no surprise to those of you who know me well!) is the inclusion of historical context to motivate the theory discussed. For instance, Prof Raj highlights and links to <a href="https://www.alanturing.net/turing_archive/pages/pub/turing3/turing3.pdf">a paper regarding Alan Turing</a>, which describes how Turing laid the theoretical groundwork for the MLP and neural networks as we know them today.</p>
<p>Another thing I like about this course is the attention to detail on the slides, which I am sure to review when I come to implement the algorithms presented. Moreover, the course includes a number of challenging homeworks, which allow you to rebuild PyTorch from scratch and work with phoneme (voice) data.</p>
<p>All in all, a great starting point for Deep Learning (assuming knowledge of basic Python, which you can pick up from, e.g., <a href="https://app.datacamp.com/learn/">DataCamp</a> or free alternatives)!</p>
<ol start="2" type="1">
<li><a href="https://www.deeplearning.ai/">DeepLearning.ai on Coursera</a></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Coursera.png" title="Coursera" class="img-fluid figure-img"></p>
<figcaption>Just a few of the course offerings available on Deeplearning.ai by Prof Ng.</figcaption>
</figure>
</div>
<p>H/t to Gavin at Purple.ai for this one. Prof Andrew Ng has put together a wealth of online courses focused solely on topics within Deep Learning, and these are offered via Coursera for certification (or you can trial/audit for free).</p>
<p>First I audited the Machine Learning in Production short course, and very much enjoyed Prof Ng’s clear explication, including practical topics like how to appropriately define a baseline for your model’s performance.</p>
<p>I subsequently audited the Generative AI with LLMs short course, which gently introduced me to topics like Reinforcement Learning with Human Feedback (RLHF), going some way beyond instruction fine-tuning to optimize your output when you interact with LLMs.</p>
<p>Most recently, I enrolled in the Generative Adversarial Networks (GANs) specialization, in which <a href="https://sharonzhou.me/">Dr Sharon Zhou</a> showcases her expertise, guiding the student through the theory of this modern architecture. I found it fascinating to learn of the necessary symbiotic relationship between the generator and the discriminator, which must be trained simultaneously if the network is to have any hope of learning.</p>
<p>A great number of pre-coded workbooks (the assignments require filling gaps – not always straightforward!) are provided to paying students, and these go as far as powerful recent models like <a href="http://arxiv.org/abs/1812.04948">StyleGAN</a>. I also very much appreciated the focus on Data Ethics, which is vital when it comes to a topic such as this, with the potential for vile misuse via Deepfakes.</p>
<p>If you have completed or are close to completing grad school, you may find the material and exercises at times straightforward, for it is aimed at a general audience, but a great many research papers are linked to (in addition to the included workbooks), so there is much to explore in as much depth as you should wish.</p>
<p>Again, I consider this an excellent collection of resources, and the GANs specialization was well worth the monthly fee (which handily cancels automatically when you have completed the specialization)! :)</p>
<ol start="3" type="1">
<li><a href="https://datalemur.com/" title="DataLemur">DataLemur</a></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="DataLemur.png" title="DataLemur" class="img-fluid figure-img"></p>
<figcaption>The DataLemur menu and interface</figcaption>
</figure>
</div>
<p>H/t to Conrad at Microsoft for this one, or rather for introducing me to <a href="https://www.amazon.com/dp/0578973839?&amp;linkCode=sl1&amp;tag=datalemur-20&amp;linkId=be42c7443fa05a3c9d783fee4e6f4762&amp;language=en_US&amp;ref_=as_li_ss_tl">Nick Singh’s book with Kevin Huo</a>, of which this website is a spin-off.</p>
<p>You’re probably familiar with <a href="https://leetcode.com/">LeetCode</a>, the test-prep app for software engineers. It’s so well-regarded as to have become a verb: “to leetcode” in advance of an interview, or for daily practice. In my experience, the LeetCode platform is indeed very useful when preparing for a coding test, but is less useful as a day-to-day tool, particularly for data scientists and aspirants. While LeetCode is well-populated with Python challenges, and comes with a very nice integrated development environment (IDE), it does not, at least at the time of writing, provide much if anything by way of practice in writing SQL queries.</p>
<p>Enter DataLemur: like LeetCode, but for SQL. It’s aimed at data scientists and analysts preparing for interviews, rather than software engineers. And while it’s interface may not be as glitzy as LeetCode’s, and it may contain a few more bugs than would be ideal, it nicely fills the gap that LeetCode has left open, allowing you to practice SQL queries to your heart’s content (unless you should run out of practice questions, but by then you will be well on your way to mastery).</p>
<p>I appreciate the hints that appear on the left-hand panel. These are particularly helpful when you are first getting started, and are unsure how to approach a problem: perhaps you are new to SQL? The website also includes SQL tutorials covering basic, intermediate and advanced commands, which help you get off the ground. But I would certainly advocate learning SQL by writing SQL, and using the hints and tutorials as fallbacks when you get stuck, not as crutches.</p>
<p>I hope you’ll forgive my relentless positivity in this post, but knowing full well that I’m repeating myself, I find this to be another great resource. I hope you’ll also forgive me for including <a href="https://datalemur.com?referralCode=rbrbEbMW">this link</a>, by which if you sign up, we might both get access to bonus questions and “exclusive prizes”!</p>
<ol start="4" type="1">
<li><a href="https://course.fast.ai/" title="fast.ai">fast.ai</a></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fastai.png" title="fastai" class="img-fluid figure-img"></p>
<figcaption>An overview of just some of the content available via fast.ai (another website produced via Quarto).</figcaption>
</figure>
</div>
<p>In some ways, fast.ai’s courses are the antithesis of what I have in mind with this blog. That is, their goal is to democratize AI, helping those without fancy PhDs to gain confidence in ML, and getting your hands dirty from lesson 1. This is indeed an admirable goal, and one I’m certainly not averse to! I’m just coming at things from a slightly difference perspective, with a somewhat different audience in mind, but I do think there is a LOT that my target audience can nonetheless take from working through fast.ai’s courses (and h/t to Nick at Purple.ai for putting me on to fast.ai).</p>
<p>Let me focus on just some of the things I love about fast.ai:</p>
<ul>
<li><p>Their pedagogy. The instructor Jeremy Howard references (amongst other texts) <a href="https://www.goodreads.com/book/show/6232657-a-mathematician-s-lament">Lockhart’s “A Mathematician’s Lament”</a>, which I first came across when I was teaching high school. Lockhart laments the school mathematics curriculum’s typical focus on mechanical operations, without relevant context – like learning only the notes to a concerto, but never hearing the music. With this in mind, the solution is to provide context first – in the case of fast.ai, to go straight in at the deep end training neural nets – before figuring out thereafter what it all means. I think this is a smart way to go, and it reminds me very much of <a href="https://gowers.wordpress.com/2007/10/19/my-favourite-pedagogical-principle-examples-first/">Gowers’s advice to present examples first</a>.</p></li>
<li><p>The pace. Within 8 lessons, you have a complete introductory course on Deep Learning for beginners. While this first course does not go into nearly as much depth as CMU’s, the second course goes beyond it, exploring stable diffusion in significant depth. Again, I appreciate the inclusion of Data Ethics, and would advise you to watch Dr Rachel Thomas’s bonus lesson in full.</p></li>
<li><p>The asides and tidbits. As well as covering the content, Jeremy takes the viewer along for so much more. How should you provision your IDE? What are tips and tricks for working most efficiently in Jupyter notebooks? What other resources should you be aware of (and I am very glad this includes all the relevant research papers)? This fast.ai course is a treasure-trove of valuable “things you ought to know but no-one ever told you”, and it’s worth following along in full to get a sense of these.</p></li>
</ul>
<p>A top resource. Yes, it’s aimed at a more-general audience, but it’s well worth your taking a look at. Pick up the tips and tricks, and delve deep into the research papers cited. A fast way to learn, for sure (but I must admit I’ve not yet been fully evangelised to try to win kaggle competitions)!</p>
<ol start="5" type="1">
<li><a href="https://missing.csail.mit.edu/">MIT’s “missing semester”</a></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="missing.png" title="missing" class="img-fluid figure-img"></p>
<figcaption>A welcome, if unconventional, approach to comparing text editors.</figcaption>
</figure>
</div>
<p>H/t to Jeremy at fast.ai for letting viewers know about this.</p>
<p>This sequence of lectures was hosted by the MIT Computer Science department, and entirely student-led. The students seek to fill the missing gaps in a typical CompSci education. Like me, you probably haven’t studied CS formally, but perhaps taken the occasional class whether in person or online. Nonetheless, I hope that you, like me, find these lectures useful, for they do indeed cover all the things you feel you ought to know in order to be more efficient in using your computer, but no-one ever told you!</p>
<p>For example, they start by running through command line prompts and how these can be piped together. I became familiar with a lot of these tools when I was studying for my MSc, but unless you use them regularly, you lose them, so I was very glad of a recap.</p>
<p>Later classes include the use of text editors (with a focus on vim) and git. I must now humbly concede my debate with Alex from UA Math, who tried to inform me of the advantages of emacs without ever convincing me. I’m now a vim convert (indeed, typing this blog in vim…), and happy to steer clear of the vim vs emacs war that rages on.</p>
<p>I like that each lecture in the series comes accompanied with exercises for the user to practice the skills learned. The pace of class is fast, so you have to be prepared to be thrown in at the deep end, knowing you may review unfamiliar concepts further on your own time.</p>
<p>All credit to the students at MIT who put this together. Check it out!</p>
<hr>
<p>That’s it for now. I hope you enjoyed reading this first blogpost. Please let me know via social media if you have.</p>
<p>NOW READ:</p>
<ul>
<li><p>Ian Hogarth’s <a href="https://www.ianhogarth.com/blog/2024/12/18/how-can-europe-build-its-first-trillion-dollar-start-up">essay</a> on what it will take for Europe to build a trillion dollar start up</p></li>
<li><p>The US AI Safety Institute’s <a href="https://www.aisi.gov.uk/work/pre-deployment-evaluation-of-openais-o1-model">Pre-Deployment Evaluation of OpenAI’s o1 Model</a></p></li>
</ul>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>